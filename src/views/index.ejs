<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>File Uploader</title>
  <link rel="stylesheet" type="text/css" href="/css/styles.css" />
</head>

<body>
  <% if (locals.username) { %>
    <h1>Hi <%= username %>
    </h1>
    <a href="/logout">Logout</a>
    <hr />
    <% if (locals.messages.uploadError) { %>
      <p class="flashErrorMessage"><%= messages.uploadError %></p>
    <% } %>
    <form action="<%= locals.postPath? postPath : '' %>/upload" method="post" enctype="multipart/form-data">
      <label for="document">Upload a file:</label>
      <input type="file" id="document" name="document" accept=".txt, .docx, .pdf, .jpg, .jpeg, .png" />
      <input type="submit" value="Submit">
    </form>
    <% if (locals.messages.folderError) { %>
      <p class="flashErrorMessage"><%= messages.folderError %></p>
    <% } %>
    <form action="<%= locals.postPath? postPath : '' %>/folder" method="post">
      <label for="folderName">Create a folder:</label>
      <input type="text" id="folderName" name="folderName">
      <input type="submit" value="Submit">
    </form>
  <% } %>
  <div class="folderPath">
    <% if (locals.folderPath) { %>
      <% folderPath.map((folder, idx) => { %>
        <% if (idx !==0 ) { %>
          <span>&gt;</span>
        <% } %>
        <a href="<%= folder.isRoot? '/' : `/folders/${folder.id}` %>"><span><%= folder.name %></span></a>
      <% }) %>
    <% } %>
  </div>
  <table class="files">
    <tr>
      <th>Name</th>
      <th>Added</th>
      <th>Delete</th>
    </tr>
    <% if (locals.folders) { %>
      <% folders.map(folder => {%>
        <tr>
          <td>
            <a href="/folders/<%=folder.id%>">
              <div style="height:100%;width:100%">
                <%= folder.name %>/
              </div>
            </a>
          </td>
          <td><%= folder.createdAt.toLocaleDateString() %></td>
          <td>
            <form action="/folders/<%=folder.id%>/delete" method="post" onsubmit="return confirm('Are you sure you want to delete <%= folder.name %>?')" >
              <input type="submit" value="Delete">
            </form>
          </td>
        </tr>
      <% }) %>
    <% } %>
    <% if (locals.files) { %>
      <% files.map(file => {%>
        <tr>
          <td><%= file.name %></td>
          <td><%= file.createdAt.toLocaleDateString() %></td>
        </tr>
      <% }) %>
    <% } %>
  </table>
</body>

</html>
